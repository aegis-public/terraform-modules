[
  {"name": "message_id", "type": "STRING", "mode": "REQUIRED"},
  {"name": "internet_message_id", "type": "STRING", "description": "Internet Message ID as defined by RFC 5322."},
  {"name": "campaign_id", "type": "STRING", "mode": "REQUIRED", "description": "Campaign UUID, duplicate of campaign.id, needed for clustering."},
  {"name": "email_address", "type": "STRING", "mode": "REQUIRED"},
  {"name": "sender", "type": "RECORD", "fields": [
    {"name": "display_name", "type": "STRING"},
    {"name": "email", "type": "STRING"},
    {"name": "domain", "type": "RECORD", "fields": [{"name": "domain", "type": "STRING"}]}
  ]},
  {"name": "original_sender", "type": "RECORD", "fields": [
    {"name": "display_name", "type": "STRING"},
    {"name": "email", "type": "STRING"},
    {"name": "domain", "type": "RECORD", "fields": [{"name": "domain", "type": "STRING"}]},
    {"name": "source", "type": "STRING"}
  ]},
  {"name": "all_recipients", "type": "RECORD", "mode": "REPEATED", "fields": [
    {"name": "display_name", "type": "STRING"},
    {"name": "email", "type": "STRING"},
    {"name": "domain", "type": "RECORD", "fields": [{"name": "domain", "type": "STRING"}]},
    {"name": "type", "type": "STRING"}
  ]},
  {"name": "subject", "type": "RECORD", "fields": [{"name": "subject", "type": "STRING"}]},
  {"name": "headers", "type": "RECORD", "fields": [
    {"name": "raw", "type": "STRING"},
    {"name": "processed", "type": "JSON"}
  ]},
  {"name": "classification", "type": "RECORD", "fields": [
    {"name": "result", "type": "STRING"},
    {"name": "risk_score", "type": "INT64"},
    {"name": "explanation", "type": "STRING"},
    {"name": "indicators", "type": "STRING", "mode": "REPEATED"},
    {"name": "latest_threat_label", "type": "STRING", "description": "Most recent threat label. Preserved when labeling as BENIGN."},
    {"name": "trigger_source", "type": "INT64", "description": "Who initiated the label change."},
    {"name": "actor_id", "type": "STRING", "description": "User or customer admin. Null for system."},
    {"name": "admin_reason", "type": "STRING", "description": "Customer-provided context for label change."},
    {"name": "last_labeled_at", "type": "TIMESTAMP", "description": "Timestamp of most recent label change."},
    {"name": "defanged_html_body_url", "type": "STRING", "description": "URL for defanged HTML. Presence indicates email was defanged."}
  ]},
  {"name": "campaign", "type": "RECORD", "mode": "NULLABLE", "fields": [
    {"name": "id", "type": "STRING", "mode": "NULLABLE", "description": "Campaign UUID"}
  ]},
  {"name": "auth_results", "type": "RECORD", "mode": "REPEATED", "fields": [
    {"name": "spf", "type": "RECORD", "fields": [
      {"name": "result", "type": "STRING"},
      {"name": "reason", "type": "STRING"}
    ]},
    {"name": "dkim", "type": "RECORD", "mode": "REPEATED", "fields": [
      {"name": "result", "type": "STRING"},
      {"name": "reason", "type": "STRING"}
    ]},
    {"name": "dmarc", "type": "RECORD", "fields": [
      {"name": "result", "type": "STRING"},
      {"name": "reason", "type": "STRING"}
    ]}
  ]},
  {"name": "inbound_gateway_auth", "type": "RECORD", "mode": "NULLABLE", "description": "Authentication results from inbound gateway (SEG) for customers with Proofpoint, Mimecast, etc. Only populated when a trusted SEG is detected.", "fields": [
    {"name": "provider", "type": "STRING", "description": "SEG provider name: PROOFPOINT, MIMECAST, etc."},
    {"name": "spf", "type": "RECORD", "fields": [
      {"name": "result", "type": "STRING"},
      {"name": "reason", "type": "STRING"}
    ]},
    {"name": "dkim", "type": "RECORD", "mode": "REPEATED", "fields": [
      {"name": "result", "type": "STRING"},
      {"name": "reason", "type": "STRING"}
    ]},
    {"name": "dmarc", "type": "RECORD", "fields": [
      {"name": "result", "type": "STRING"},
      {"name": "reason", "type": "STRING"}
    ]}
  ]},
  {"name": "urls", "type": "RECORD", "mode": "REPEATED", "fields": [
    {"name": "display_name", "type": "STRING"},
    {"name": "original", "type": "STRING"},
    {"name": "derived", "type": "RECORD", "mode": "REPEATED", "fields": [
      {"name": "url", "type": "STRING"},
      {"name": "domain", "type": "RECORD", "fields": [{"name": "domain", "type": "STRING"}]}
    ]},
    {"name": "final_domain", "type": "RECORD", "fields": [{"name": "domain", "type": "STRING"}]}
  ]},
  {"name": "attachments", "type": "RECORD", "mode": "REPEATED", "fields": [
    {"name": "file_name", "type": "STRING"},
    {"name": "sha256", "type": "STRING"}
  ]},
  {"name": "received_at", "type": "TIMESTAMP", "mode": "REQUIRED"},
  {"name": "processed_at", "type": "TIMESTAMP", "mode": "REQUIRED"}
]
